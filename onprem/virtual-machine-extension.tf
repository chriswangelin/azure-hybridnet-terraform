# See https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/custom-script-linux
# Run "base64" command on "install-docker.sh" to get encoded value for script parameter
resource "azurerm_virtual_machine_extension" "dns_vm_001_customscript_vmext" {
  name                 = "dns_vm_001_customscript"
  virtual_machine_id   = module.dns_vm_001.vm_id
  publisher            = "Microsoft.Azure.Extensions"
  type                 = "CustomScript"
  type_handler_version = "2.0"

  settings = <<SETTINGS
  {
    "script": "IyBVcGRhdGUgcGFja2FnZXMKeXVtIHVwZGF0ZSAteQp5dW0gdXBncmFkZSAteQoKIyBJbnN0YWxsIEROUyBwYWNrYWdlcwp5dW0gaW5zdGFsbCB1bmJvdW5kIC15CiAKICMgSW5pdGlhbGl6ZSB1bmJvdW5kIGxvZyBmaWxlCiB0b3VjaCAvdmFyL2xvZy91bmJvdW5kLmxvZwogY2hvd24gdW5ib3VuZDp1bmJvdW5kIC92YXIvbG9nL3VuYm91bmQubG9nCiAjIFNldCBzZWxpbnV4IGZpbGUgdHlwZSB0byBuYW1lZF9sb2dfdCB0eXBlCiBzZW1hbmFnZSBmY29udGV4dCAtYSAtdCBuYW1lZF9sb2dfdCAiL3Zhci9sb2cvdW5ib3VuZC5sb2ciCiAjIEFwcGx5IHRoZSBjaGFuZ2VzCiByZXN0b3JlY29uIC12IC92YXIvbG9nL3VuYm91bmQubG9nCgoKIyBDb25maWd1cmUgdW5ib3VuZCBETlMKY3AgLXAgL2V0Yy91bmJvdW5kL3VuYm91bmQuY29uZiAvZXRjL3VuYm91bmQvdW5ib3VuZC5jb25mLm9yaWcKY2F0ID4gL2V0Yy91bmJvdW5kL3VuYm91bmQuY29uZiA8PCBFT0YKc2VydmVyOgogIGNocm9vdDogIiIKICBsb2dmaWxlOiAvdmFyL2xvZy91bmJvdW5kLmxvZwogIHZlcmJvc2l0eTogMQogIGxvZy1xdWVyaWVzOiB5ZXMKICAgIGludGVyZmFjZTogMC4wLjAuMAogICAgICBhY2Nlc3MtY29udHJvbDogMTAuMC4wLjAvMTYgYWxsb3cKICAgICAgYWNjZXNzLWNvbnRyb2w6IDE3Mi4xNi4wLjAvMTYgYWxsb3cKICAgICAgdmVyYm9zaXR5OiAxCgogIGxvY2FsLXpvbmU6ICJvbnByZW0ubmV0LiIgc3RhdGljCgogICAgbG9jYWwtZGF0YTogIm9ucHJlbS13aW5yYS12bS5vbnByZW0ubmV0LiAgICAgIElOIEEgMTcyLjE2LjAuNCIKICAgIGxvY2FsLWRhdGE6ICJvbnByZW0tZG5zLXZtLTAwMS5vbnByZW0ubmV0LiAgICBJTiBBIDE3Mi4xNi4yNTQuNCIKCiAgICBsb2NhbC1kYXRhLXB0cjogIjE3Mi4xNi4wLjQgICBvbnByZW0td2lucmEtdm0ub25wcmVtLm5ldCIKICAgIGxvY2FsLWRhdGEtcHRyOiAiMTcyLjE2LjI1NC40IG9ucHJlbS1kbnMtdm0tMDAxLm9ucHJlbS5uZXQiCgogIGZvcndhcmQtem9uZToKICAgIG5hbWU6ICIuIgogICAgZm9yd2FyZC1hZGRyOiAxMC4wLjI1NC40CkVPRgoKIyBDb25maWd1cmUgZmlyZXdhbGwgdG8gYWxsb3cgRE5TIGxvb2t1cHMKZmlyZXdhbGwtY21kIC0tem9uZT1wdWJsaWMgLS1hZGQtc2VydmljZSBkbnMgLS1wZXJtYW5lbnQKZmlyZXdhbGwtY21kIC0tcmVsb2FkCgojIERpc2FibGUgTmV0d29ya01hbmFnZXIgY29udHJvbCBvZiAvZXRjL3Jlc29sdi5jb25mCmNhdCA+IC9ldGMvTmV0d29ya01hbmFnZXIvY29uZi5kLzkwLWRucy1ub25lLmNvbmYgPDwgRU9GClttYWluXQpkbnM9bm9uZQpFT0YKCiMgU2V0IG5hbWVzZXJ2ZXIgdG8gbG9jYWwgaG9zdAplY2hvICJuYW1lc2VydmVyIDEyNy4wLjAuMSIgPiAvZXRjL3Jlc29sdi5jb25mIAoKCiMgQ29uZml1Z3VyZSBldGgwIHRvIHVzZSBsb2NhbCB1bmJvdW5kIHNlcnZpY2UgZm9yIEROUyBsb29rdXBzCm5tY2xpIGNvbiBtb2QgIlN5c3RlbSBldGgwIiBpcHY0Lmlnbm9yZS1hdXRvLWRucyB0cnVlCm5tY2xpIGNvbiBtb2QgIlN5c3RlbSBldGgwIiBpcHY0LmRucyAxMjcuMC4wLjEKc3lzdGVtY3RsIHJlbG9hZCBOZXR3b3JrTWFuYWdlcgoKIyBFbmFibGUgYW5kIHN0YXJ0IHVuYm91bmQKc3lzdGVtY3RsIGVuYWJsZSB1bmJvdW5kCnN5c3RlbWN0bCBzdGFydCB1bmJvdW5kCnN5c3RlbWN0bCBzdGF0dXMgdW5ib3VuZA=="
  }
SETTINGS
}
